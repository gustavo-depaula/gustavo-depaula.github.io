<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <title>Missal</title>

    <link rel="stylesheet" href="/styles.css" />

    <style>
      .instructions {
        padding-left: 0.2em;
        color: #940000;
        font-size: 0.9em;
        padding-bottom: 0;
      }

      .instructions .reference {
        color: black;
      }

      #introit-antiphon {
        padding-left: 2em;
        font-style: italic;
      }

      .priest:before {
        content: "℣ ";
        width: 1em;
        margin-left: -1em;
      }

      .space-between {
        display: flex;
        justify-content: space-between;
      }

      .priest {
        /* font-family: heal; */
        font-style: italic;
      }

      .people {
        font-size: 1.1em;
        font-weight: bold;
      }

      .people:before {
        content: "℟ ";
        width: 1em;
        margin-left: -1em;
      }

      .alternative {
        color: #4d4d4d;
        padding-left: 1em;
      }

      .people .instructions {
        padding-left: 1em;
        font-style: normal;
        font-weight: normal;
        font-size: 0.8em;
      }

      .reading-title {
        color: #940000;
      }

      .reading {
      }
    </style>
  </head>

  <body>
    <div class="content">
      <header></header>

      <main>
        <div style="padding-left: 25px">
          <h1 class="page-title">Missal</h1>
          <h2 id="data" />

          <h1>Ritos Iniciais</h1>

          <p class="instructions">
            1. Reunido o povo, o sacerdote dirige-se com os ministros ao altar,
            enquanto se executa o canto de entrada.
          </p>

          <div id="introit">
            <p class="instructions">
              <b>Antífona de entrada</b>
              <span id="introit-reference"></span>
            </p>
            <p id="introit-antiphon">Hey</p>
          </div>

          <p class="instructions">
            Chegando ao altar, faz com os ministros uma profunda inclinação,
            beija o altar em sinal de veneração e, se for oportuno, incensa a
            cruz e o altar. Depois se dirige com os ministros à cadeira.
            <br />

            Terminado o canto de entrada, o sacerdote e os fiéis, todos de pé,
            fazem o sinal da cruz, enquanto o sacerdote, voltado para o povo,
            diz:
          </p>

          <p class="priest">✠ Em nome do Pai e do Filho e do Espírito Santo.</p>

          <p class="instructions">O povo responde:</p>

          <p class="people">Amém.</p>

          <p class="instructions">
            2. Em seguida, o sacerdote, abrindo os braços, saúda o povo com uma
            das seguintes fórmulas:
          </p>

          <p>
            <span class="instructions">a) Cf. 2Cor 13,13</span>
            <br />
            <span class="priest">
              A graça de nosso Senhor Jesus Cristo, o amor do Pai e a comunhão
              do Espírito Santo estejam convosco.
            </span>
          </p>

          <p>
            <span class="instructions">b) Cf. 1Cor 1,3</span>
            <br />
            <span class="priest">
              A graça e a paz de Deus, nosso Pai, e de Jesus Cristo, nosso
              Senhor, estejam convosco.
            </span>
          </p>

          <p>
            <span class="instructions"
              >O Bispo, nesta primeira saudação diz:</span
            >
            <br />
            <span class="priest"> A paz esteja convosco. </span>
          </p>

          <p class="instructions">O povo responde:</p>

          <p class="people">
            Bendito seja Deus, que nos reuniu no amor de Cristo.
          </p>

          <p class="alternative">
            <span class="instructions"
              >Ou, o sacerdote, abrindo os braços, diz:</span
            >
            <br />
            <span class="priest"> O Senhor esteja convosco. </span>
            <br />
            <span class="instructions"> O povo responde: </span>
            <br />
            <span class="people">Ele está no meio de nós.</span>
          </p>

          <p class="instructions">
            3. O sacerdote, o diácono ou outro ministro poderá, com brevíssimas
            palavras, introduzir os fiéis na Missa do dia.
          </p>

          <h2>Ato Penitencial</h2>

          <p class="instructions">
            4. O sacerdote convida os fiéis ao ato penitencial:
          </p>

          <p>
            Irmãos e irmãs, reconheçamos os nossos pecados, para celebrarmos
            dignamente os santos mistérios.
          </p>

          <p class="alternative">
            <span class="instructions">Ou:</span>
            <br />
            O Senhor Jesus, que nos convida à mesa da Palavra e da Eucaristia,
            nos chama a segui-lo fielmente. Reconheçamos ser pecadores e
            invoquemos com confiança a misericórdia do Pai.
            <br />
            <span class="instructions"
              >Ou, especialmente aos domingos e durante a oitava da
              Páscoa:</span
            >
            <br />
            O Senhor Jesus, que nos convida à mesa da Palavra e da Eucaristia,
            nos chama a segui-lo fielmente. Reconheçamos ser pecadores e
            invoquemos com confiança a misericórdia do Pai.
          </p>

          <p class="instructions">
            Após um momento de silêncio, usa-se a seguinte fórmula: O sacerdote
            diz:
          </p>
          <p class="priest">Confessemos os nossos pecados:</p>
          <p class="instructions">Todos:</p>

          <p class="people">
            Confesso a Deus todo-poderoso e a vós, irmãos e irmãs,
            <br />
            que pequei muitas vezes por pensamentos e palavras, atos e omissões,
            <br />
            <span class="instructions">e, batendo no peito, dizem:</span>
            <br />
            por minha culpa, minha culpa, minha tão grande culpa.
            <br />
            <span class="instructions">Em seguinda, continuam:</span>
            <br />
            E peço à Virgem Maria, aos Anjos e Santos e a vós, irmãos e irmãs,
            <br />
            que rogueis por mim a Deus, nosso Senhor.
          </p>

          <p class="instructions">Segue-se a absolvição sacerdotal:</p>

          <p class="priest">
            Deus todo-poderoso tenha compaixão de nós, perdoe os nossos pecados
            e nos conduza à vida eterna.
          </p>

          <p class="people">Amém.</p>

          <p class="instructions">
            7. Seguem-se as invocações
            <span class="reference"
              >Senhor, tende piedade de nós (Kýrie, eléison)</span
            >, caso já não tenham ocorrido no ato penitencial:
          </p>

          <p style="display: flex; flex-direction: column; gap: 7px">
            <span class="priest">
              Senhor, tende piedade de nós.
              <span class="alternative">Ou:</span>
              Kýrie, eléison.
            </span>
            <span class="people">
              Senhor, tende piedade de nós.
              <span class="alternative">Ou:</span>
              Kýrie, eléison.
            </span>

            <span class="priest">
              Cristo, tende piedade de nós.
              <span class="alternative">Ou:</span>
              Christe, eléison.
            </span>
            <span class="people">
              Cristo, tende piedade de nós.
              <span class="alternative">Ou:</span>
              Christe, eléison.
            </span>

            <span class="priest">
              Senhor, tende piedade de nós.
              <span class="alternative">Ou:</span>
              Kýrie, eléison.
            </span>
            <span class="people">
              Senhor, tende piedade de nós.
              <span class="alternative">Ou:</span>
              Kýrie, eléison.
            </span>
          </p>

          <p class="instructions">
            8. Quando for prescrito, canta-se ou recita-se em seguida o hino:
          </p>
          <p class="people" style="font-weight: normal">
            Glória a Deus nas alturas, <br />
            e paz na terra aos homens por ele amados.<br />
            Senhor Deus, rei dos céus,<br />
            Deus Pai todo-poderoso.<br />
            Nós vos louvamos,<br />
            nós vos bendizemos,<br />
            nós vos adoramos,<br />
            nós vos glorificamos,<br />
            nós vos damos graças por vossa imensa glória.<br />
            <br />
            Senhor Jesus Cristo, Filho Unigênito,<br />
            Senhor Deus, Cordeiro de Deus, Filho de Deus Pai.<br />
            Vós que tirais o pecado do mundo, tende piedade de nós.<br />
            Vós que tirais o pecado do mundo, acolhei a nossa súplica.<br />
            Vós que estais à direita do Pai, tende piedade de nós.<br />

            <br />
            Só vós sois o Santo,<br />
            só vós, o Senhor,<br />
            só vós, o Altíssimo, Jesus Cristo,<br />
            com o Espírito Santo, na glória de Deus Pai.<br />

            <br />
            Amém.
          </p>

          <p class="instructions">
            9. Terminado o hino, de mãos unidas, o sacerdote diz:
          </p>
          <p class="priest">Oremos.</p>
          <p class="instructions">
            E todos oram com o sacerdote, por algum tempo, em silêncio.
            <br />
            Então o sacerdote, de braços abertos, profere a oração Coleta;
            <br />ao terminar, o povo aclama:
          </p>
          <p class="people">Amém.</p>

          <div class="divider" />

          <h1>Liturgia da Palavra</h1>

          <h2>Primeira Leitura</h2>

          <p class="reading-title">
            <span id="first-reading-title" style="font-weight: bold">{}</span>
            <span id="first-reading-reference">{}</span>
          </p>

          <p id="first-reading" class="reading"></p>

          <div class="divider" />
          <h1>Liturgia Eucarística</h1>
          <div class="divider" />
          <h1>Ritos Finais</h1>
        </div>
      </main>
    </div>

    <script src="/script.js"></script>
    <script>
      function extractReference(text) {
        // Regex para capturar a referência no formato "(Cf. Sl 85, 1-3)" no final da string
        const regex = /\s*\(Cf\. [^)]+\)\s*$/;

        // Extrair a referência usando o regex
        const match = text.match(regex);

        // Se houver uma correspondência, separa o texto em duas partes
        if (match) {
          const reference = match[0].trim();
          const mainText = text.replace(regex, "").trim();
          return { mainText, reference };
        } else {
          // Se não houver referência, retorna o texto original e uma string vazia
          return { mainText: text, reference: "" };
        }
      }

      function removeVerseReferences(text) {
        // Regex para capturar padrões de referências como "1Josué", "2aEntão", "18bPortanto", etc.
        const regex = /(\d+[a-z]?)/g;

        // Substitui as referências encontradas que estão grudadas nas palavras
        let cleanedText = text.replace(regex, "");

        // Corrige espaços adicionais deixados após a remoção das referências
        cleanedText = cleanedText.replace(/\s+/g, " ").trim();

        // Retorna o texto limpo
        return cleanedText;
      }

      function addNewlineAfterPeriodExceptInQuotes(text) {
        let inQuotes = false;
        let result = "";

        for (let i = 0; i < text.length; i++) {
          const char = text[i];

          // Verifica se estamos dentro de aspas
          if (char === '"' || char === "“" || char === "”") {
            inQuotes = !inQuotes;
          }

          // Se for um ponto final e não estivermos dentro de aspas, adiciona a nova linha
          if (char === "." && !inQuotes) {
            result += ".\n\n";
          } else {
            result += char;
          }
        }

        return result;
      }

      fetch("https://liturgiadiaria.site/")
        .then((response) => response.json())
        .then((data) => {
          console.log(data);

          document.getElementById("data").textContent =
            `${data.liturgia}, ${data.data}`;

          const { mainText: antifonaEntrada, reference: antifonaEntradaSalmo } =
            extractReference(data.antifonas.entrada);
          document.getElementById("introit-antiphon").textContent =
            antifonaEntrada;
          document.getElementById("introit-reference").textContent =
            antifonaEntradaSalmo;

          document.getElementById("first-reading-title").textContent =
            data.primeiraLeitura.titulo;
          document.getElementById("first-reading-reference").textContent =
            `(${data.primeiraLeitura.referencia})`;

          document.getElementById("first-reading").innerText =
            addNewlineAfterPeriodExceptInQuotes(
              removeVerseReferences(data.primeiraLeitura.texto),
            );

          console.log(removeVerseReferences(data.primeiraLeitura.texto));
        });
    </script>
  </body>
</html>
